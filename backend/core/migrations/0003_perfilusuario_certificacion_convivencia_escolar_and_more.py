# Generated by Django 5.2.7 on 2025-11-06 19:38

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0002_add_protocolos_anonimato'),
    ]

    operations = [
        migrations.AddField(
            model_name='perfilusuario',
            name='certificacion_convivencia_escolar',
            field=models.BooleanField(default=False, help_text='¿Tiene certificación en convivencia escolar?'),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='email_institucional',
            field=models.EmailField(blank=True, max_length=254),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='fecha_nombramiento',
            field=models.DateField(blank=True, help_text='Fecha de nombramiento como Encargado de Convivencia', null=True),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='fecha_ultima_capacitacion',
            field=models.DateField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='instituciones_capacitacion',
            field=models.TextField(blank=True, help_text='Instituciones donde recibió capacitación'),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='jornada_laboral_horas',
            field=models.PositiveIntegerField(blank=True, help_text='Horas semanales de dedicación (mínimo 44h según normativa)', null=True),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='numero_registro_profesional',
            field=models.CharField(blank=True, help_text='Número de registro en colegio profesional', max_length=50),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='profesion',
            field=models.CharField(blank=True, choices=[('educacion', 'Profesional de la Educación'), ('psicologia', 'Psicólogo(a)'), ('trabajo_social', 'Trabajador(a) Social'), ('psicopedagogia', 'Psicopedagogo(a)'), ('orientacion', 'Orientador(a)'), ('otra', 'Otra Profesión Afín')], max_length=20),
        ),
        migrations.AddField(
            model_name='perfilusuario',
            name='telefono_emergencia',
            field=models.CharField(blank=True, max_length=20),
        ),
        migrations.CreateModel(
            name='AlertaLegal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tipo_alerta', models.CharField(choices=[('denuncia_24h', 'Denuncia Obligatoria 24h'), ('notificacion_apoderado_48h', 'Notificación Apoderado 48h'), ('resolucion_caso_10d', 'Resolución de Caso 10 días'), ('seguimiento_medidas_30d', 'Seguimiento Medidas 30 días'), ('vencimiento_apelacion', 'Vencimiento Plazo Apelación'), ('reporte_mineduc', 'Reporte MINEDUC')], max_length=30)),
                ('fecha_limite', models.DateTimeField()),
                ('estado', models.CharField(choices=[('activa', 'Activa'), ('enviada', 'Enviada'), ('atendida', 'Atendida'), ('vencida', 'Vencida')], default='activa', max_length=15)),
                ('mensaje', models.TextField()),
                ('enviada', models.BooleanField(default=False)),
                ('fecha_envio', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('destinatarios', models.ManyToManyField(related_name='alertas_recibidas', to='core.perfilusuario')),
                ('incidente', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='alertas_legales', to='core.incidentreport')),
            ],
            options={
                'verbose_name': 'Alerta Legal',
                'verbose_name_plural': 'Alertas Legales',
                'ordering': ['fecha_limite'],
            },
        ),
        migrations.CreateModel(
            name='DenunciaObligatoria',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('es_constitutivo_delito', models.BooleanField(default=False)),
                ('tipos_delito', models.JSONField(default=list, help_text='Lista de tipos de delito identificados')),
                ('fecha_conocimiento', models.DateTimeField(help_text='Fecha en que se toma conocimiento del hecho')),
                ('fecha_limite_denuncia', models.DateTimeField(help_text='Fecha límite para realizar denuncia (24h)')),
                ('fecha_denuncia_realizada', models.DateTimeField(blank=True, null=True)),
                ('autoridad_denunciada', models.CharField(blank=True, choices=[('carabineros', 'Carabineros de Chile'), ('pdi', 'Policía de Investigaciones'), ('fiscalia', 'Fiscalía Local'), ('tribunal_familia', 'Tribunal de Familia')], max_length=20)),
                ('numero_denuncia', models.CharField(blank=True, max_length=100)),
                ('documento_denuncia', models.FileField(blank=True, null=True, upload_to='denuncias/')),
                ('observaciones', models.TextField(blank=True)),
                ('denunciante_institucional', models.ForeignKey(limit_choices_to={'tipo_usuario__in': ['directivo', 'encargado_convivencia']}, on_delete=django.db.models.deletion.PROTECT, to='core.perfilusuario')),
                ('incidente', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='denuncia_obligatoria', to='core.incidentreport')),
            ],
            options={
                'verbose_name': 'Denuncia Obligatoria',
                'verbose_name_plural': 'Denuncias Obligatorias',
            },
        ),
        migrations.CreateModel(
            name='MedidaDisciplinaria',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gravedad_infraccion', models.CharField(choices=[('leve', 'Leve'), ('menos_grave', 'Menos Grave'), ('grave', 'Grave'), ('gravisima', 'Gravísima')], max_length=15)),
                ('fecha_notificacion_estudiante', models.DateTimeField()),
                ('fecha_notificacion_apoderado', models.DateTimeField()),
                ('plazo_descargos_dias', models.PositiveIntegerField(default=5)),
                ('descargos_presentados', models.TextField(blank=True)),
                ('fecha_presentacion_descargos', models.DateTimeField(blank=True, null=True)),
                ('tipo_medida', models.CharField(choices=[('amonestacion_verbal', 'Amonestación Verbal'), ('amonestacion_escrita', 'Amonestación Escrita'), ('suspension_temporal', 'Suspensión Temporal'), ('reduccion_jornada', 'Reducción de Jornada Escolar'), ('separacion_temporal', 'Separación Temporal de Actividades'), ('condicionalidad', 'Condicionalidad de Matrícula'), ('cancelacion_matricula', 'Cancelación de Matrícula'), ('no_renovacion', 'No Renovación de Matrícula')], max_length=25)),
                ('descripcion_medida', models.TextField()),
                ('duracion_dias', models.PositiveIntegerField(blank=True, null=True)),
                ('fundamentacion_proporcionalidad', models.TextField(help_text='Fundamentación de la proporcionalidad de la medida')),
                ('cumple_principio_proporcionalidad', models.BooleanField(default=True)),
                ('permite_apelacion', models.BooleanField(default=True)),
                ('plazo_apelacion_dias', models.PositiveIntegerField(default=5)),
                ('fecha_limite_apelacion', models.DateTimeField(blank=True, null=True)),
                ('apelacion_presentada', models.BooleanField(default=False)),
                ('fecha_apelacion', models.DateTimeField(blank=True, null=True)),
                ('fundamentos_apelacion', models.TextField(blank=True)),
                ('resolucion_apelacion', models.TextField(blank=True)),
                ('apelacion_acogida', models.BooleanField(blank=True, null=True)),
                ('fecha_inicio_aplicacion', models.DateField(blank=True, null=True)),
                ('fecha_fin_aplicacion', models.DateField(blank=True, null=True)),
                ('medida_cumplida', models.BooleanField(default=False)),
                ('aplicada_por', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.perfilusuario')),
                ('incidente', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='medidas_disciplinarias', to='core.incidentreport')),
            ],
            options={
                'verbose_name': 'Medida Disciplinaria',
                'verbose_name_plural': 'Medidas Disciplinarias',
            },
        ),
        migrations.CreateModel(
            name='NotificacionLegal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tipo_notificacion', models.CharField(choices=[('apoderado_caso_leve', 'Notificación a Apoderado - Caso Leve'), ('apoderado_caso_grave', 'Notificación a Apoderado - Caso Grave'), ('mineduc_caso_grave', 'Notificación MINEDUC - Caso Muy Grave'), ('fiscalia_delito', 'Denuncia Fiscalía - Delito'), ('pdi_delito', 'Denuncia PDI - Delito'), ('carabineros_delito', 'Denuncia Carabineros - Delito'), ('superintendencia', 'Notificación Superintendencia de Educación'), ('tribunal_familia', 'Notificación Tribunal de Familia'), ('opd_vulneracion', 'Notificación OPD - Vulneración Derechos')], max_length=30)),
                ('plazo_maximo_horas', models.PositiveIntegerField(help_text='Plazo máximo legal en horas')),
                ('fecha_limite', models.DateTimeField()),
                ('destinatario_nombre', models.CharField(max_length=255)),
                ('destinatario_email', models.EmailField(blank=True, max_length=254)),
                ('destinatario_telefono', models.CharField(blank=True, max_length=20)),
                ('institucion_destinatario', models.CharField(blank=True, max_length=255)),
                ('estado', models.CharField(choices=[('pendiente', 'Pendiente'), ('enviada', 'Enviada'), ('recibida', 'Recibida/Confirmada'), ('vencida', 'Vencida')], default='pendiente', max_length=15)),
                ('fecha_envio', models.DateTimeField(blank=True, null=True)),
                ('fecha_confirmacion', models.DateTimeField(blank=True, null=True)),
                ('numero_seguimiento', models.CharField(blank=True, help_text='Número de seguimiento oficial', max_length=100)),
                ('asunto', models.CharField(max_length=255)),
                ('mensaje', models.TextField()),
                ('documentos_adjuntos', models.FileField(blank=True, null=True, upload_to='notificaciones/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('enviado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.perfilusuario')),
                ('incidente', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notificaciones_legales', to='core.incidentreport')),
            ],
            options={
                'verbose_name': 'Notificación Legal',
                'verbose_name_plural': 'Notificaciones Legales',
                'ordering': ['fecha_limite'],
            },
        ),
        migrations.CreateModel(
            name='ReglamentoInterno',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('descripcion_conductas_violencia', models.TextField(help_text='Descripción precisa de conductas que constituyen violencia escolar')),
                ('procedimientos_gestion_conflictos', models.TextField(help_text='Procedimientos para gestionar conflictos y situaciones de violencia')),
                ('medidas_pedagogicas_convivencia', models.TextField(help_text='Diversas medidas pedagógicas que fomenten la buena convivencia')),
                ('procedimiento_reconocimiento_positivo', models.TextField(help_text='Procedimiento de reconocimiento y reforzamiento de conductas positivas')),
                ('protocolos_violencia_escolar', models.TextField(help_text='Protocolos de actuación para casos de violencia escolar')),
                ('formas_participacion_comunidad', models.TextField(help_text='Diversas formas de participación de la comunidad educativa')),
                ('programa_capacitacion', models.TextField(help_text='Programa de capacitación para docentes, asistentes y directivos')),
                ('version', models.CharField(max_length=10)),
                ('fecha_aprobacion_consejo_escolar', models.DateField()),
                ('fecha_vigencia', models.DateField()),
                ('vigente', models.BooleanField(default=True)),
                ('archivo_reglamento', models.FileField(blank=True, null=True, upload_to='reglamentos/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('colegio', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='reglamento_interno', to='core.colegio')),
            ],
            options={
                'verbose_name': 'Reglamento Interno',
                'verbose_name_plural': 'Reglamentos Internos',
            },
        ),
        migrations.CreateModel(
            name='SeguimientoLegal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('clasificacion_legal', models.CharField(choices=[('tipo_i_leve', 'Tipo I - Situación Leve'), ('tipo_ii_grave', 'Tipo II - Situación Grave'), ('tipo_iii_muy_grave', 'Tipo III - Situación Muy Grave'), ('constitutivo_delito', 'Constitutivo de Delito')], max_length=20)),
                ('protocolo_aplicado', models.CharField(blank=True, max_length=255)),
                ('fecha_inicio_protocolo', models.DateTimeField()),
                ('fecha_limite_protocolo', models.DateTimeField()),
                ('etapa_denuncia_completada', models.BooleanField(default=False)),
                ('etapa_medidas_urgentes_completada', models.BooleanField(default=False)),
                ('etapa_notificacion_completada', models.BooleanField(default=False)),
                ('etapa_investigacion_completada', models.BooleanField(default=False)),
                ('etapa_resolucion_completada', models.BooleanField(default=False)),
                ('etapa_apelacion_disponible', models.BooleanField(default=True)),
                ('etapa_seguimiento_completada', models.BooleanField(default=False)),
                ('notificado_apoderado', models.BooleanField(default=False)),
                ('fecha_notificacion_apoderado', models.DateTimeField(blank=True, null=True)),
                ('notificado_mineduc', models.BooleanField(default=False)),
                ('fecha_notificacion_mineduc', models.DateTimeField(blank=True, null=True)),
                ('denunciado_autoridades', models.BooleanField(default=False)),
                ('fecha_denuncia_autoridades', models.DateTimeField(blank=True, null=True)),
                ('medidas_proteccion_aplicadas', models.TextField(blank=True)),
                ('medidas_formativas_aplicadas', models.TextField(blank=True)),
                ('sanciones_aplicadas', models.TextField(blank=True)),
                ('documentos_proceso', models.FileField(blank=True, null=True, upload_to='procesos_legales/')),
                ('actas_generadas', models.TextField(blank=True, help_text='Lista de actas y documentos generados')),
                ('cumple_normativa', models.BooleanField(default=False)),
                ('observaciones_cumplimiento', models.TextField(blank=True)),
                ('incidente', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='seguimiento_legal', to='core.incidentreport')),
            ],
            options={
                'verbose_name': 'Seguimiento Legal',
                'verbose_name_plural': 'Seguimientos Legales',
            },
        ),
        migrations.CreateModel(
            name='CumplimientoLey20536',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('periodo_inicio', models.DateField()),
                ('periodo_fin', models.DateField()),
                ('total_casos', models.PositiveIntegerField(default=0)),
                ('casos_requieren_denuncia', models.PositiveIntegerField(default=0)),
                ('denuncias_en_plazo', models.PositiveIntegerField(default=0)),
                ('casos_notificados_plazo', models.PositiveIntegerField(default=0)),
                ('casos_resueltos_plazo', models.PositiveIntegerField(default=0)),
                ('medidas_proporcionales', models.PositiveIntegerField(default=0)),
                ('debido_proceso_completo', models.PositiveIntegerField(default=0)),
                ('porcentaje_denuncias_plazo', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('porcentaje_notificaciones_plazo', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('porcentaje_resoluciones_plazo', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('porcentaje_debido_proceso', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('cumplimiento_general', models.DecimalField(decimal_places=2, default=0, max_digits=5)),
                ('generado_automaticamente', models.BooleanField(default=True)),
                ('fecha_generacion', models.DateTimeField(auto_now_add=True)),
                ('colegio', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='cumplimiento_ley', to='core.colegio')),
            ],
            options={
                'verbose_name': 'Cumplimiento Ley 20.536',
                'verbose_name_plural': 'Cumplimientos Ley 20.536',
                'unique_together': {('colegio', 'periodo_inicio', 'periodo_fin')},
            },
        ),
        migrations.CreateModel(
            name='PlazoLegal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tipo_plazo', models.CharField(choices=[('notificacion_apoderado', 'Notificación a Apoderado'), ('investigacion_completa', 'Investigación Completa'), ('resolucion_caso', 'Resolución del Caso'), ('denuncia_autoridades', 'Denuncia a Autoridades'), ('reporte_mineduc', 'Reporte a MINEDUC'), ('seguimiento_medidas', 'Seguimiento de Medidas'), ('apelacion', 'Plazo de Apelación')], max_length=25)),
                ('plazo_horas', models.PositiveIntegerField()),
                ('es_plazo_habiles', models.BooleanField(default=True)),
                ('fecha_inicio', models.DateTimeField()),
                ('fecha_limite', models.DateTimeField()),
                ('estado', models.CharField(choices=[('pendiente', 'Pendiente'), ('en_curso', 'En Curso'), ('cumplido', 'Cumplido'), ('vencido', 'Vencido'), ('prorrogado', 'Prorrogado')], default='pendiente', max_length=15)),
                ('fecha_cumplimiento', models.DateTimeField(blank=True, null=True)),
                ('observaciones', models.TextField(blank=True)),
                ('fecha_prorroga', models.DateTimeField(blank=True, null=True)),
                ('justificacion_prorroga', models.TextField(blank=True)),
                ('autorizada_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='prorrogas_autorizadas', to='core.perfilusuario')),
                ('incidente', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='plazos_legales', to='core.incidentreport')),
                ('responsable', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.perfilusuario')),
            ],
            options={
                'verbose_name': 'Plazo Legal',
                'verbose_name_plural': 'Plazos Legales',
                'unique_together': {('incidente', 'tipo_plazo')},
            },
        ),
        migrations.CreateModel(
            name='ReporteMINEDUC',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('tipo_reporte', models.CharField(choices=[('mensual', 'Reporte Mensual'), ('trimestral', 'Reporte Trimestral'), ('semestral', 'Reporte Semestral'), ('anual', 'Reporte Anual'), ('caso_grave', 'Reporte Caso Grave'), ('seguimiento', 'Reporte de Seguimiento')], max_length=15)),
                ('periodo_inicio', models.DateField()),
                ('periodo_fin', models.DateField()),
                ('total_casos', models.PositiveIntegerField(default=0)),
                ('casos_tipo_i', models.PositiveIntegerField(default=0)),
                ('casos_tipo_ii', models.PositiveIntegerField(default=0)),
                ('casos_tipo_iii', models.PositiveIntegerField(default=0)),
                ('casos_delito', models.PositiveIntegerField(default=0)),
                ('medidas_formativas_aplicadas', models.PositiveIntegerField(default=0)),
                ('sanciones_aplicadas', models.PositiveIntegerField(default=0)),
                ('derivaciones_externas', models.PositiveIntegerField(default=0)),
                ('estado', models.CharField(choices=[('borrador', 'Borrador'), ('generado', 'Generado'), ('enviado', 'Enviado'), ('recibido', 'Recibido por MINEDUC')], default='borrador', max_length=15)),
                ('archivo_reporte', models.FileField(blank=True, null=True, upload_to='reportes_mineduc/')),
                ('numero_seguimiento_mineduc', models.CharField(blank=True, max_length=100)),
                ('fecha_generacion', models.DateTimeField(blank=True, null=True)),
                ('fecha_envio', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('colegio', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reportes_mineduc', to='core.colegio')),
                ('generado_por', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.perfilusuario')),
            ],
            options={
                'verbose_name': 'Reporte MINEDUC',
                'verbose_name_plural': 'Reportes MINEDUC',
                'unique_together': {('colegio', 'tipo_reporte', 'periodo_inicio')},
            },
        ),
    ]
